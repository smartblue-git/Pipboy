ªmsg(a){console.log(a),bC.clear(1).setColor(3).setFontAlign(0,0),bC.drawImage(dc(robco),115,50),bC.setFontMonofonto23().drawString(a,190,170),bC.flip()}ªtypeText(e,g){typeTimeržclearTimeout(typeTimer),(g gŠ·)ž(e=e.toUpperCase());­f=0;­b=0;­d=e.split(/\x20|\xa0|\x09/);­c=d[0];®a=20;«typeXŠ0žtypeYŠ0ž(bC.clear(),bC.drawImage(dc(robco),115,20),typeY=120),¸Promise(g¢{ªe(){£(bŠ0žtypeX+bC.stringWidth(c)>bC.getWidth()ž(typeX=0,typeY–a),typeY>bC.getHeight()-až(bC.scroll(0,-a),typeY—a),b<c.length){­d=c[b˜];bC.drawString(d,typeX,typeY),bC.flip(),Pip.audioStartVar(clicks[Math.random()*clicks.length|0]),typeX–bC.stringWidth(d),(dŠ'\n' typeX>bC.getWidth()-6)ž(typeX=0,typeY–a)}¤{£(b=0,typeXž(typeX–8),!(˜f<d.length)){typeTimeržclearTimeout(typeTimer),typeTimer=0,g();«}c=d[f]}typeTimer=setTimeout(e,Math.random()*50|0)}bC.setFontMonofonto16().setFontAlign(-1,-1).setColor(3),e()})}ªerr(b){msg(b);­a=10;setInterval(b¢{bC.setFontMonofonto16().drawString(' Rebooting in '+™a+'s ',190,220,!0),aŠ0žE.reboot()},1e3),setInterval(bC.flip,50)}ªupdateFirmware(){®a=(require('Storage').read('VERSION') '').trim();®b=parseInt(require('fs').readFileSync('pipboy.crc'));typeText('********** Pip-OS(R) '+process.env.VERSION+' - '+a+' ********** Pip-Boy serial number: '+getID()+'\n').then(()¢typeText('\nInstalling new firmware - please wait...')).then(()¢{E.unmountSD(),Pip.setDACPower(0),poke32(1073818624,0),poke32(1073874980,peek32(1073874980)&-1048576),poke32(1073876e3,peek32(1073876e3)&-3841),[D2,C8,C9,C10,C11,C12].forEach(a¢pinMode(a,'input')),SD_PWR.reset(),t=getTime()+.5;¦(getTime()<t);SD_PWR.set(),SD_CS.mode('output'),SD_CS.set(),SD_MOSI.mode('output'),SD_SCLK.mode('output'),C9.mode('output'),C9.set(),C10.mode('output'),C10.set();¬a=¸SPI;a.setup({mosi:SD_MOSI,miso:SD_MISO,sck:SD_SCLK,baud:1e5}),pinMode(SD_MISO,'input_pullup');ªi(){­b=2e3;¦(a.send(255)Œ255ž™b);£(!b)°¸Error('wait_ready fail')}ªe(f,b,c){¬d;c (c=255),SD_CS.set(),SD_CS.reset(),i(),SD_CS.set(),SD_CS.reset(),a.write([64|f,b’24&255,b’16&255,b’8&255,b&255,c]);¬e=1e4;¦((d=a.send(255))&128ž™e);£(!e)°¸Error('send_cmd'+f+' timeout '+d);«d}ªk(a,b,c){«e(55,0,101),e(a,b,c)}console.log(' - Putting SD card into SPI mode');§(¬h=0;h<10;h˜)a.send(255);SD_CS.reset(),i();¬c,d,f;d=2e3;¦((c=e(0,0,149))Œ1ž™d);£(!d)°¸Error('CMD0 '+c);£(e(8,426,135)&4)f='SD1';¤{£(c=a.send([255,255,255,255]),c[3]Œ170)°¸Error('CMD8');f='SD2'}d=2e3;¦((c=k(41,1073741824,119))Œ0ž™d);£(!d)°¸Error('ACMD41 '+c);£(fŠ'SD2'){£(e(58,0,253))°¸Error('READ_OCR');c=a.send([255,255,255,255]),(c[0]&192)Š192ž(f='SDHC')}console.log(' - SD card type: '+f),SD_CS.set(),LED1.write(0);¬j;§(­l=0;l<5;l˜){j=compiled.go(b),g.clearRect(100,250,380,270),t=getTime()+.5;¦(getTime()<t);}err('Firmware update failed\ncode 0x'+j.toString(16).padStart(4,0))})}®SD_SCLK=C12;®SD_MOSI=D2;®SD_MISO=C8;®SD_CS=C11;®SD_PWR=D3;¬compiled=ª(a){«a=E.toFlatString(atob('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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA')),{go:E.nativeCall(1765,'int(int,int)',a)}}();­robco=atob('y1MgX/AAtACI0PBQPAA4d/Con4CpIAD/o3HBQP8AwcfCwvwCpAAE+hKNgYWGKwhKIOBBKGN4phIJTvQJTk/JX5K/JX5KLBIJKUFIZKJCoIpCJSPwgEvJRYVBJSsCJX5K/JX5KNlWqAAYKDAoOrwBKHgQVE0BKHAYQAC/oGF/xKIBwn/75KGoQOF+AGGv5KCAAcfB4pKHG4QADJQv/g5KDAAUBEg5KmCIRKh44EDJX5K/JTH5t5KF1ZKNyxKJ+BKCgBKF6E/JRnwLopKD/kCBwpKC/sDJRo7DJQ0AJUXQgBKi/wOBJUQRBSsdAJScu1Wq4JKL/hKTA4X9JRi7BJSQSC6JKLXYJKjG4hKPA4RKJ4YDCoBKgGQS7BJT7qCDIJKgDgS7BJT/A34KCJRP+JSoNCXYJKQ/NVHgRKKXYZKC+tfJQtXJQoADJQdVJQsBFIZKCAAY3FJQYAEJQQAG4C7DJQQADJQQGEJRQAF/kAXYZKgXYdCJUC7C/BKgXYfCJRo3CJR4/C/pKF/xKZXYfiJSn8QwxKDXYZZFJQ3+QQYADoIGF95KDGAX0aQuALoxwG6AHF/EAAH4AJqoCBqkBqEAgoHCgIIDgFqoEAitVqEBqtUBQMVDwVVBwMC0kP+EAj7OBBoKuBAYMv4F/AgM/BALKCwCoBDAMLAQLKB/okBWQITBZgNDBobnBgX8g4IDVAM/AYIZBaQQzCAwPgAwP/54EBj/4JQX+v4IBJQcBBAPAgWv/dAl/WIYIzD+2YAYX+JQfDBoXQ/5KFFIP0GQQLCh5DCBIYAB/sLx5KC/xKCBIIcBJQcCIIIABEAQLBD4JKDBIIDBAwJKC/fzJQd/oBKFHgZKDj/QSoj4C//kFYUft4NC/sHWQLgEdIZKDZYTJEAYMHAYJKC+oJCJQWAJQkDcARKDbINAcAoDBGALgDp4JCJQKVFgEG/5oBJQgDBJQf1qAlCcAf036VKXgiVDGATgGIwIxCj+DJQbGCJQN+DoPwF4JKE4ZaBcA0bwG/JQcvBoXiHwX+CYU/wRKGn/AJQxbBYAJKCoBKCUYIUBBgLUBWYQICJQXBFgLgEAwIDCEAMB/BrCBIJfBgG//+Ae4hKECgW/HgYwBv//xZKDRgINB9ADBgLbCBoP4AYMLA4MfRQJKDhZKCFgOQA=');­clicks=[atob('VwBPAEkAyf/S/sf+cgBBAW3/wv0P//cAeQC0/ib+9wD8Am8BSP+N/u3/2wHEABn/V/5X/3kBogF5AMv+NP6F/1wABADW/8D+iP+VAUIBFQDE/of+jwDjAFEAwv/8/kMBjwFL/2//dQCrAVYByP7J//UApACDABD+jf0H/2f/bwGN//D96/88/0gCLQJx/qcAHv32/ecGmQMaAD37L/Y1BpcLL/3i+0r5T/95DIf/ofgkAET9gwL9Axf8MgKW/5v6ZgJYAqH/8gGl/hf+iv9pAMgDdwJH/jr9O/8pAdUAB/+ZAQL/efz8AWEEXQII/hP1vv1IC1gDkP7C+/31CwSKC3D+ev/t9sj1/RE0DbL39vkD8gwBgRoU/wj2mf5Z7d4HIxea96D/7vO37bsbxAvz7/EB4vB/AE0Zp/b0AXUGGegQA/cM8v5VDfD26O9FCj4AlwB+Cvf1vfdMA4T/JQvlBIDyovhX/i0DWQ8fB5X19vC5+QULsxMnAovwMvaJApoKfwhd+0HzOPoCAncJKwqz+zj0gPt2AmsJFQYK/DX8HPtb/CIH5gcr/kz5RPoFBFUJ5P+p+qb9Fv5TAaADVwL//xj5s/kgBL8H3wHP/A78VAC6AmkAe/9C/gr+3gPjBBcAevuN+qkBrQY5AXr7UPwiAdsESQEY/kf+PP2V/rAE8QXv/3r3gPfKA/UIUgNP/UD72P3xATcCmgKWATH7gvq8Af0FywT1/WX5yvw4AvME5wJ//Wf62v1yAsQEvwNK/8b7/fzj/wwCxgJJ/zv8Lv7vAS0EkAGB/Hf9MQGmAXwBfwBi/kz+QP4oAFUCIgB6/h0AqAHFAML9Jf0ZAUMCHwAZAFYBkgDn/dH+TgK9An//TPzB/qkDeQNe/yD9V/2DAGkCkwA3AOL+4vyZ/yEBSwE0ApH/o/1Z/vX/SQOgAhP+6vxH/xQCrAHs/cX9jAB4ACAA'),atob('dABFAJD/NAB9/9P//ADI/87/5P9U/yABRgCa/nkAPQBCAMEAZf6d/0QBx/+8AOb/SP4cAKUAWwHNAM/9gf5vAPEBkgHU/rr+jv7X/10DhgCV/iH/j/3BATIDLP+p///9f/5iAh0AxgBXAav+iv6P/RABmgQxAEv+Lv05/kcEYAHf/nkA+PsdAHYEh/6eANH/NfwMA5IAAf6qA4r9d/17BAD+6P6AAuP8jgJ6ApD6VwG3AMH9XQXS/wP8EAHU/GUBUQae/Sn+mf4T/J0EOAWk/tb9xPqo/T4GGgX9AHb85/eT/d8GjwccATn6Jviy/pkGzgaLAVb6o/eD/ikHlwdhAbn5Yve2/qIGpgcBAgX60fdQ/p0FPQepAr36CfgX/k4F9QYxAvf6Kvl7/iQEEgaLArP7zPl5/r0DHAW1AYT8+vsY/78B/wKCAeX+5P1f/vH/PQLYAXH/ev6n/lEAPgGHACYA8f8g/wX/GADCABYBdQBN/z3/O/9k/74A7AEbAUL/g/3S/aABqAMuAeD9l/zk/r0CSQNyALL9pfwT/90CUQOdAHz9tfxc/70ChAJOAGD+jv1l/3cBDgL3AO/+sf3x/jwB6gFUARH/q/3w/t4A6AFwAWD/lf3L/hUBFQLHAIv+j/77/xMB6QCu/wP/wP+cAH4A4/92/8v/ZQCPANX/L/+7/7EA6QDs/wT/UP85AMsAiQDb/1L/zf8XABEAOwAfABUA8v/G/6//+v9uAHwA7v9U/4z/PQDYAHoAdf8H/7z/3wDtANv/Cf90/24AqgAYALn/tf/e/w=='),atob('wQDYACoAWwBdASsBRQILAtsAJQGUAD0B8f9I/v/+WAD1/7z+Fv7E/7L+Mfye/fz9/P4oAkT9x/7VA5UAOATo/qf6+Aj8B8r7Kv8I/CQFGwz79b73CgVK//EBw/7+9s8DRgRy+o0CxgSM+fAANv9K+ycORwKT7FoCBQU4BWMPze3R99AOQfdJAhUGwvW5CLv5G+83DZYGB/1DANj0EQThEx4DW/fd93v9cgcGCiX5uPd3/xn7jwViCrj8O/zl94n7Tw7eB1f8UvYD9tEFBA55Awz7o/er/YMGNgbZ/xf6mPr8/MkC5wQrALD6tfYs/ZcJqQrlAnj4yfbEAkAMdwkb/d/zVPvmB4QKKwKF9iL3Rf9EB2AHmf+c93H1xvx6BXAIugC09uf2CQEYCq8IOv8E+If7nwT1Cf8FTPx3+fL8OQHHBLMEtv7/9zb56gCKB8EDvfoY+U3+hAbrB0T/qPgY+x8DTgfuA+79ofxo/nQBJQMQAYH+I/yV/HX/cANoAS37ZfqA/1gFPATL/4X9HP4xAMQB8gLqAMv+BP5o/z4EhAWaAJv6nvswArYE/wAI/QX9S/8rAisDwQCc/an8OP8wAs4CNAEi/iT+8//bAFYA2P3g/dH+A/9d/7b/of7R/V//mQDHAaEBiP/Z/mIBAQPjAj4C7gCV/5MAdgJZAu0AIP6V/j8AEgBG/xf/g/6c/ZD+ef6//r//q/3a/VcB3AEcALv/7wCvAtED3wBX/14AGQBw/6b+BABxAQr/+fyH/zoCZQB7/WT9MACXAnQBNP8D/zkBtwEHABX/If8bAcAAxf8gAUoAVf9Y/8P/HQH/AD3+AP31/oUA8/9l/5H/IwAmAIj/KAB8AFoABAHNACv/cwAaAR8A2/8dACIBKwIhAgQAzP9W/7f+O/+Q/9//agD6/ygAgQD6/xQA7wA='),atob('nwCrAegBwgFtAPD/eQF/AXD/7P5y/2r/xv44/1//0/3r/lMBnwC8/3T/EACCAXABcgBM/3EAZgFQ/5X+gv9XARYBWf9H/0wAjwE2Afb+GP6aAPH/O/9lAGP/6P9TAL7/KQGTAOD/TwFd/l3+HAIZAKj91fyI/X0BcwFM/0v/6gCGAnYAKv5EAKoEkAMd/uH8SQALAzoCC/6q/NMA8gFc/1X9hv3D/yQAjf6x/pb+zgCEA/AAoP7T+/UA3weKArX+zfxt/XMIlwNY+iz/Ivv0AeQJ3fnB+97/DfwfC9r8AO89AisFogmhBLrpa/q3Eg0LIwMj8O7wow4XDcP8FflD9nkDSgtq/1T7jf70/w8E0QHp+VT+hwcaBncBnviv8ykDvAtzBin7C+9L+DcKkgthAYv0vvSpAzcLQwai/Ef5Bf8fBPYC7/4tAHUDgwE2/UL9rwFTBRgDlf0G+qT5QP6cA9IEAgOL/Jf3gvr3AQEJ/gWs/BP44/rDAzYLKwhu/5H3dPZX/5EKOwwNAkn1LfKh/XsKZAwRAi3zgPAr/T8Kfg1ZAnn1ivTt/SAJMgzNAx/6QPaM+SYDDgoTCI/+DfV/9ksBQglZCBAAYvjE+BX/IgZbCSQEOvwI+PT7uwOzBnEERv7S+BH6Sv+5A/sEkQEn+zf4M/0tBIwHTAOd/Kb5VvwfAxAI0gUq/wL6yvpDAXEGtQUbAAD66vdW/JUD/gafATn6Jvl5/hME2gXeAuz81Pq9/vkDFAbDA+r+Bvw2/SQCHAT0ARz/gvzN/AX/5gHGAm//vPtN/Pn+ZAI8A38AO/7D/mcAdgHGAccBSAGc/kz+Kv+sAGwCgwBV/Uf9yf8XAvr/nv7Z/pb+PADDAGcADgG1AZkAI/8B//gBXAOKAAr+zf46AE4BkADL/pT95fz5/UgAkQKwAWz+e/3z/7YCfwOXAU8A9P8DAGsAq/+OABgCIv+i/Gn+JAFUAeb9aPvv/RABDwFF/0r+SQCvAUoB3gDUANoBDAINANL+h/8=')];­dc=require('heatshrink').decompress;­bC=Graphics.createArrayBuffer(380,260,2,{msb:!0,buffer:E.toArrayBuffer(E.memoryArea(268468224,3e4))});bC.flip=()¢Pip.blitImage(bC,50,30);¬typeX=0,typeY=0,typeTimer;getID=()¢{­b=peek32(536836624);­d=peek32(536836632);­c=peek32(536836628);­a='';§(­e=0;e<4;e˜)a–String.fromCharCode(d’24-e*8&255);§(i=0;i<3;i˜)a–String.fromCharCode(c’24-i*8&255);«a–'-'+(c&255).toString(16).padStart(2,'0'),a–'-'+((b&16711680)’16).toString(16).padStart(2,'0')+(b&255).toString(16).padStart(2,'0'),a}